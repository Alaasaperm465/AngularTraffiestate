<!-- Add Property - Multi Step Form -->
<div class="add-property-wrapper">

  <!-- Header Hero Section -->
  <section class="add-property-hero">
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <h1 class="hero-title">{{ 'forms.add_property.title' | translate }}</h1>
      <p class="hero-subtitle">{{ 'forms.add_property.subtitle' | translate }}</p>
    </div>
  </section>

  <!-- Main Content -->
  <div class="container">
    <div class="add-property-container">

      <!-- Progress Steps -->
      <div class="steps-container">
        <div class="steps-wrapper">
          <div
            *ngFor="let step of [1, 2, 3, 4]"
            class="step-item"
            [class.active]="isStepActive(step)"
            [class.completed]="isStepCompleted(step)"
            (click)="goToStep(step)">
            <div class="step-number">
              <span *ngIf="!isStepCompleted(step)">{{ step }}</span>
              <i *ngIf="isStepCompleted(step)" class="bi bi-check-lg"></i>
            </div>
            <div class="step-info">
              <span class="step-label">{{ 'forms.add_property.step' | translate }} {{ step }}</span>
              <span class="step-title">{{ getStepTitle(step) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Container -->
      <form class="form-container" [ngSwitch]="currentStep">

        <!-- STEP 1: BASIC INFORMATION -->
        <div *ngSwitchCase="1" class="form-step">
          <div class="step-header">
            <h2 class="step-title-main">{{ getStepTitle(1) }}</h2>
            <p class="step-description">{{ getStepDescription(1) }}</p>
          </div>

          <div class="form-group">
            <label for="title" class="form-label">{{ 'forms.add_property.property_title' | translate }} <span class="required">*</span></label>
            <input
              type="text"
              id="title"
              class="form-control"
              [(ngModel)]="property.title"
              name="title"
              [placeholder]="placeholders['forms.add_property.title_placeholder']"
              [class.error]="showValidationErrors && property.title.trim() === ''">
            <small class="error-text" *ngIf="showValidationErrors && property.title.trim() === ''">
              {{ 'forms.add_property.title_required' | translate }}
            </small>
          </div>

          <div class="form-group">
            <label for="description" class="form-label">{{ 'forms.add_property.description' | translate }} <span class="required">*</span></label>
            <textarea
              id="description"
              class="form-control textarea"
              [(ngModel)]="property.description"
              name="description"
              rows="5"
              [placeholder]="placeholders['forms.add_property.description_placeholder']"
              [class.error]="showValidationErrors && property.description.trim() === ''"></textarea>
            <small class="error-text" *ngIf="showValidationErrors && property.description.trim() === ''">
              {{ 'forms.add_property.description_required' | translate }}
            </small>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="propertyType" class="form-label">{{ 'forms.add_property.property_type' | translate }} <span class="required">*</span></label>
              <select
                id="propertyType"
                class="form-control"
                [(ngModel)]="property.propertyType"
                (change)="onPropertyTypeChange()"
                name="propertyType"
                [class.error]="showValidationErrors && property.propertyType === ''">
                <option value="">{{ 'forms.add_property.select_type' | translate }}</option>
                <option value="Apartment">{{ 'forms.add_property.apartment' | translate }}</option>
                <option value="Villa">{{ 'forms.add_property.villa' | translate }}</option>
                <option value="House">{{ 'forms.add_property.house' | translate }}</option>
                <option value="Studio">{{ 'forms.add_property.studio' | translate }}</option>
                <option value="Townhouse">{{ 'forms.add_property.townhouse' | translate }}</option>
                <option value="Land">{{ 'forms.add_property.land' | translate }}</option>
              </select>
              <small class="error-text" *ngIf="showValidationErrors && property.propertyType === ''">
                {{ 'forms.add_property.property_type_required' | translate }}
              </small>
            </div>

            <div class="form-group">
              <label for="purpose" class="form-label">{{ 'forms.add_property.purpose' | translate }} <span class="required">*</span></label>
              <select
                id="purpose"
                class="form-control"
                [(ngModel)]="property.purpose"
                name="purpose"
                [disabled]="property.propertyType === 'Land'"
                [class.error]="showValidationErrors && property.purpose === ''">
                <option value="">{{ 'forms.add_property.select_purpose' | translate }}</option>
                <option value="Buy">{{ 'forms.add_property.for_sale' | translate }}</option>
                <option value="Rent" *ngIf="property.propertyType !== 'Land'">{{ 'forms.add_property.for_rent' | translate }}</option>
                <option value="Sale" *ngIf="property.propertyType === 'Land'">{{ 'forms.add_property.for_sale' | translate }}</option>
              </select>
              <small class="error-text" *ngIf="showValidationErrors && property.purpose === ''">
                {{ 'forms.add_property.purpose_required' | translate }}
              </small>
              <small class="info-text" *ngIf="property.propertyType === 'Land'">
                {{ 'forms.add_property.land_only_sale' | translate }}
              </small>
            </div>
          </div>
        </div>

        <!-- STEP 2: LOCATION -->
        <div *ngSwitchCase="2" class="form-step">
          <div class="step-header">
            <h2 class="step-title-main">{{ getStepTitle(2) }}</h2>
            <p class="step-description">{{ getStepDescription(2) }}</p>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="city" class="form-label">{{ 'forms.add_property.city' | translate }} <span class="required">*</span></label>
              <select
                id="city"
                class="form-control"
                [(ngModel)]="property.cityId"
                name="cityId"
                (change)="onCityChange()"
                [class.error]="showValidationErrors && property.cityId === 0">
                <option value="0">{{ 'forms.add_property.select_city' | translate }}</option>
                <option *ngFor="let city of cities" [value]="city.id">{{ city.name }}</option>
              </select>
              <small class="error-text" *ngIf="showValidationErrors && property.cityId === 0">
                {{ 'forms.add_property.city_required' | translate }}
              </small>
            </div>

            <div class="form-group">
              <label for="area" class="form-label">{{ 'forms.add_property.area' | translate }} <span class="required">*</span></label>
              <select
                id="area"
                class="form-control"
                [(ngModel)]="property.areaId"
                name="areaId"
                [disabled]="areas.length === 0"
                [class.error]="showValidationErrors && property.areaId === 0">
                <option value="0">{{ 'forms.add_property.select_area' | translate }}</option>
                <option *ngFor="let area of areas" [value]="area.id">{{ area.name }}</option>
              </select>
              <small class="error-text" *ngIf="showValidationErrors && property.areaId === 0">
                {{ 'forms.add_property.area_required' | translate }}
              </small>
            </div>
          </div>

          <div class="form-group">
            <label for="location" class="form-label">{{ 'forms.add_property.street_address' | translate }} <span class="required">*</span></label>
            <input
              type="text"
              id="location"
              class="form-control"
              [(ngModel)]="property.location"
              name="location"
              [placeholder]="placeholders['forms.add_property.location_placeholder']"
              [class.error]="showValidationErrors && property.location.trim() === ''">
            <small class="error-text" *ngIf="showValidationErrors && property.location.trim() === ''">
              {{ 'forms.add_property.location_required' | translate }}
            </small>
          </div>
        </div>

        <!-- STEP 3: PROPERTY DETAILS -->
        <div *ngSwitchCase="3" class="form-step">
          <div class="step-header">
            <h2 class="step-title-main">{{ getStepTitle(3) }}</h2>
            <p class="step-description">{{ getStepDescription(3) }}</p>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="price" class="form-label" >{{ 'forms.add_property.price' | translate }} <span class="required">*</span></label>
              <input
                type="number"
                id="price"
                class="form-control"
                [(ngModel)]="property.price"
                name="price"
                placeholder="0"
                min="0"
                [class.error]="showValidationErrors && property.price === 0">
              <small class="error-text" *ngIf="showValidationErrors && property.price === 0">
                {{ 'forms.add_property.price_required' | translate }}
              </small>
            </div>

            <div class="form-group">
              <label for="areaSpace" class="form-label" >{{ 'forms.add_property.area_space' | translate }} <span class="required">*</span></label>
              <input
                type="number"
                id="areaSpace"
                class="form-control"
                [(ngModel)]="property.areaSpace"
                name="areaSpace"
                placeholder="0"
                min="0"
                [class.error]="showValidationErrors && property.areaSpace === 0">
              <small class="error-text" *ngIf="showValidationErrors && property.areaSpace === 0">
                {{ 'forms.add_property.area_space_required' | translate }}
              </small>
            </div>
          </div>

          @if(property.propertyType === 'Land'){
          <!-- Land does not require rooms and bathrooms -->
          }
          @else {
             <div class="form-row">
            <div class="form-group">
              <label for="rooms" class="form-label">{{ 'forms.add_property.rooms' | translate }} <span class="required">*</span></label>
              <input
                type="number"
                id="rooms"
                class="form-control"
                [(ngModel)]="property.rooms"
                name="rooms"
                placeholder="0"
                min="0"
                [class.error]="showValidationErrors && property.rooms === 0">
              <small class="error-text" *ngIf="showValidationErrors && property.rooms === 0">
                {{ 'forms.add_property.rooms_required' | translate }}
              </small>
            </div>

            <div class="form-group">
              <label for="bathrooms" class="form-label">{{ 'forms.add_property.bathrooms' | translate }} <span class="required">*</span></label>
              <input
                type="number"
                id="bathrooms"
                class="form-control"
                [(ngModel)]="property.bathrooms"
                name="bathrooms"
                placeholder="0"
                min="0"
                [class.error]="showValidationErrors && property.bathrooms === 0">
              <small class="error-text" *ngIf="showValidationErrors && property.bathrooms === 0">
                {{ 'forms.add_property.bathrooms_required' | translate }}
              </small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="finishingLevel" class="form-label">{{ 'forms.add_property.finishing_level' | translate }} <span class="required">*</span></label>
              <select
                id="finishingLevel"
                class="form-control"
                [(ngModel)]="property.finishingLevel"
                name="finishingLevel"
                [class.error]="showValidationErrors && property.finishingLevel === ''">
                <option value="">{{ 'forms.add_property.select_level' | translate }}</option>
                <option value="Standard">{{ 'forms.add_property.standard' | translate }}</option>
                <option value="Semi-Furnished">{{ 'forms.add_property.semi_furnished' | translate }}</option>
                <option value="Luxury">{{ 'forms.add_property.luxury' | translate }}</option>
              </select>
              <small class="error-text" *ngIf="showValidationErrors && property.finishingLevel === ''">
                {{ 'forms.add_property.finishing_required' | translate }}
              </small>
            </div>


          </div>
        }

      </div>

        <!-- STEP 4: IMAGES -->
        <div *ngSwitchCase="4" class="form-step">
          <div class="step-header">
            <h2 class="step-title-main">{{ getStepTitle(4) }}</h2>
            <p class="step-description">{{ getStepDescription(4) }}</p>
          </div>

          <!-- Main Image -->
          <div class="form-group">
            <label class="form-label">{{ 'forms.add_property.main_image' | translate }} <span class="required">*</span></label>
            <div class="image-upload-area">
              <div *ngIf="!mainImagePreview" class="upload-placeholder">
                <i class="bi bi-cloud-upload"></i>
                <p>{{ 'forms.add_property.upload_placeholder' | translate }}</p>
                <small>{{ 'forms.add_property.file_types' | translate }}</small>
              </div>
              <div *ngIf="mainImagePreview" class="image-preview-main">
                <img [src]="mainImagePreview" alt="Main Image Preview">
                <button type="button" class="remove-btn" (click)="removeMainImage()">
                  <i class="bi bi-x-lg"></i>
                </button>
              </div>
              <input
                type="file"
                class="file-input"
                accept="image/*"
                (change)="onMainImageChange($event)">
            </div>
            <small class="error-text" *ngIf="showValidationErrors && !mainImage">
              {{ 'forms.add_property.main_image_required' | translate }}
            </small>
          </div>

          <!-- Additional Images -->
          <div class="form-group">
            <label class="form-label">{{ 'forms.add_property.additional_images' | translate }}</label>
            <div class="image-upload-area">
              <div *ngIf="additionalImagesPreview.length === 0" class="upload-placeholder">
                <i class="bi bi-cloud-upload"></i>
                <p>{{ 'forms.add_property.upload_placeholder_additional' | translate }}</p>
                <small>{{ 'forms.add_property.multiple_files' | translate }}</small>
              </div>
              <div class="images-preview-grid" *ngIf="additionalImagesPreview.length > 0">
                <div
                  *ngFor="let preview of additionalImagesPreview; let i = index"
                  class="image-preview-item">
                  <img [src]="preview" [alt]="'Additional Image ' + (i + 1)">
                  <button type="button" class="remove-btn" (click)="removeAdditionalImage(i)">
                    <i class="bi bi-x-lg"></i>
                  </button>
                </div>
              </div>
              <input
                type="file"
                class="file-input"
                accept="image/*"
                multiple
                (change)="onAdditionalImagesChange($event)">
            </div>
          </div>

          <!-- Images Summary -->
          <div class="images-summary">
            <p>
              <strong>{{ 'forms.add_property.main_image' | translate }}:</strong>
              <span *ngIf="mainImage">{{ mainImage.name }}</span>
              <span *ngIf="!mainImage" class="text-danger">{{ 'forms.add_property.not_selected' | translate }}</span>
            </p>
            <p *ngIf="additionalImages.length > 0">
              <strong>{{ 'forms.add_property.additional_images' | translate }}:</strong> {{ additionalImages.length }} {{ 'forms.add_property.files' | translate }}
            </p>
          </div>
        </div>

      </form>

      <!-- Form Navigation Buttons -->
      <div class="form-navigation">
        <button
          class="btn btn-secondary"
          (click)="previousStep()"
          [disabled]="currentStep === 1">
          <i class="bi bi-chevron-right"></i>
          {{ 'common.previous' | translate }}
        </button>

        <div class="progress-info">
          <span class="progress-text">{{ 'forms.add_property.step' | translate }} {{ currentStep }} {{ 'forms.add_property.of' | translate }} {{ totalSteps }}</span>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="(currentStep / totalSteps) * 100"></div>
          </div>
        </div>

        <button
          *ngIf="currentStep < totalSteps"
          class="btn btn-primary"
          (click)="nextStep()">
          {{ 'common.next' | translate }}
          <i class="bi bi-chevron-left"></i>
        </button>

        <button
          *ngIf="currentStep === totalSteps"
          class="btn btn-success"
          (click)="submit()"
          [disabled]="isSubmitting">
          <span *ngIf="!isSubmitting">
            <i class="bi bi-check-lg"></i>
            {{ 'forms.add_property.submit_property' | translate }}
          </span>
          <span *ngIf="isSubmitting">
            <i class="bi bi-hourglass-split"></i>
            {{ 'forms.add_property.submitting' | translate }}
          </span>
        </button>
      </div>

    </div>
  </div>

</div>
