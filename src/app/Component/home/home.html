<!-- Hero Section -->
<section class="hero-section">
  <div class="hero-overlay"></div>
  <div class="hero-content-wrapper">

    <div class="hero-text-content">
      <h1 class="hero-main-title">{{ 'home.hero.main_title' | translate }}</h1>
      <p class="hero-description">{{ 'home.hero.description' | translate }}</p>

      <!-- Search Box in Hero -->
      <div class="hero-search-box">
        <form [formGroup]="searchForm" (ngSubmit)="onSearch()" class="hero-search-form">

          <!-- Tabs Inside Search -->
          <div class="search-tabs-hero">
            <button
              type="button"
              class="tab-btn-hero"
              [class.active]="activeTab === 'buy'"
              (click)="setActiveTab('buy')">
              <i class="bi bi-house-door"></i>
              {{ 'home.hero.tabs.buy' | translate }}
            </button>
            <button
              type="button"
              class="tab-btn-hero"
              [class.active]="activeTab === 'rent'"
              (click)="setActiveTab('rent')">
              <i class="bi bi-key"></i>
              {{ 'home.hero.tabs.rent' | translate }}
            </button>
            <button
              type="button"
              class="tab-btn-hero"
              [class.active]="activeTab === ''"
              (click)="setActiveTab('')">
              <i class="bi bi-grid"></i>
              {{ 'home.hero.tabs.all' | translate }}
            </button>
          </div>

          <div class="search-fields-wrapper">
            <!-- City Input -->
            <div class="search-field-hero">
              <i class="bi bi-geo-alt"></i>
              <input
                type="text"
                formControlName="city"
                [placeholder]="'home.hero.search_placeholder' | translate"
                class="search-input-hero">
            </div>

            <!-- Property Type Dropdown -->
            <div class="search-field-hero dropdown-wrapper">
              <i class="bi bi-house-door"></i>
              <input
                type="text"
                formControlName="propertyType"
                [placeholder]="'home.hero.property_type' | translate"
                class="search-input-hero"
                readonly
                (click)="togglePropertyTypeDropdown()">
              <i class="bi bi-chevron-down toggle-icon"></i>

              <div class="dropdown-menu-hero" *ngIf="showPropertyTypeDropdown">
                <div class="dropdown-item-hero" (click)="searchForm.patchValue({propertyType: 'Apartment'}); showPropertyTypeDropdown = false">
                  <i class="bi bi-building"></i>
                  {{ 'home.hero.apartment' | translate }}
                </div>
                <div class="dropdown-item-hero" (click)="searchForm.patchValue({propertyType: 'Villa'}); showPropertyTypeDropdown = false">
                  <i class="bi bi-house"></i>
                  {{ 'home.hero.villa' | translate }}
                </div>
                <div class="dropdown-item-hero" (click)="searchForm.patchValue({propertyType: 'Land'}); showPropertyTypeDropdown = false">
                  <i class="bi bi-house-door"></i>
                  {{ 'home.hero.land' | translate }}
                </div>
              </div>
            </div>

            <!-- Rooms Dropdown -->
            <div class="search-field-hero dropdown-wrapper">
              <i class="bi bi-door-open"></i>
              <input
                type="text"
                formControlName="rooms"
                [placeholder]="'home.hero.bedrooms' | translate"
                class="search-input-hero"
                readonly
                (click)="toggleBedsAndBathsDropdown()">
              <i class="bi bi-chevron-down toggle-icon"></i>

              <div class="dropdown-menu-hero" *ngIf="showBedsAndBathsDropdown">
                <div class="dropdown-item-hero" (click)="searchForm.patchValue({rooms: '1'}); showBedsAndBathsDropdown = false">
                  <i class="bi bi-1-circle"></i>
                  {{ 'home.hero.1_bedroom' | translate }}
                </div>
                <div class="dropdown-item-hero" (click)="searchForm.patchValue({rooms: '2'}); showBedsAndBathsDropdown = false">
                  <i class="bi bi-2-circle"></i>
                  {{ 'home.hero.2_bedrooms' | translate }}
                </div>
                <div class="dropdown-item-hero" (click)="searchForm.patchValue({rooms: '3'}); showBedsAndBathsDropdown = false">
                  <i class="bi bi-3-circle"></i>
                  {{ 'home.hero.3_bedrooms' | translate }}
                </div>
                <div class="dropdown-item-hero" (click)="searchForm.patchValue({rooms: '4'}); showBedsAndBathsDropdown = false">
                  <i class="bi bi-4-circle"></i>
                  {{ 'home.hero.4_plus_bedrooms' | translate }}
                </div>
              </div>
            </div>

            <!-- Search Button -->
            <button type="submit" class="search-btn-hero" [title]="'home.hero.search' | translate">
              <i class="bi bi-search"></i>
            </button>

            <!-- Clear Button -->
            <button type="button" class="search-btn-hero clear-btn" [title]="'common.clear' | translate" (click)="clearAllFilters()">
              {{ 'common.clear' | translate }}
            </button>
          </div>
        </form>

        <!-- Quick Search -->
        <div class="quick-search-hero">
          <span class="quick-label">{{ 'home.hero.popular' | translate }} </span>
          <button type="button" class="quick-btn-hero" (click)="setQuickSearch('Cairo')">{{ 'home.buy.cairo' | translate }}</button>
          <button type="button" class="quick-btn-hero" (click)="setQuickSearch('Alexandria')">{{ 'home.buy.alexandria' | translate }}</button>
          <button type="button" class="quick-btn-hero" (click)="setQuickSearch('Giza')">{{ 'home.buy.giza' | translate }}</button>
          <button type="button" class="quick-btn-hero" (click)="setQuickSearch('New Cairo')">{{ 'home.buy.new_cairo' | translate }}</button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Filters & Properties Section -->
<section class="properties-main-section">
  <div class="container-full">
    <div class="main-layout">

      <!-- Properties Grid -->
      <div class="properties-content">
        <div class="properties-header">
          <h2 class="properties-count">
            <span class="count-number">{{ properties.length }}</span> {{ 'home.properties.found' | translate }}
            <span class="page-info" *ngIf="displayedProperties.length > 0">
              ({{ 'home.properties.showing' | translate }} {{ displayedProperties.length }} {{ 'home.properties.of' | translate }} {{ properties.length }})
            </span>
          </h2>
          <div class="view-toggle">
            <button type="button" class="view-btn active" [title]="'home.properties.grid_view' | translate">
              <i class="bi bi-grid-3x3-gap"></i>
            </button>
            <button type="button" class="view-btn" [title]="'home.properties.list_view' | translate">
              <i class="bi bi-list"></i>
            </button>
          </div>
        </div>

        <!-- Properties Grid -->
        <div class="properties-grid" *ngIf="properties.length > 0">
          <div
            class="property-card"
            *ngFor="let property of displayedProperties; trackBy: trackById">

            <!-- Property Image -->
            <div class="property-image">
              <img [src]="property.imageUrl || 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=400'"
                   [alt]="property.title">

              <!-- Favorite Button -->
              <button
                type="button"
                class="favorite-btn"
                [class.active]="isFavorite(property.id)"
                (click)="toggleFavorite(property.id); $event.stopPropagation()">
                <i class="bi" [ngClass]="isFavorite(property.id) ? 'bi-heart-fill' : 'bi-heart'"></i>
              </button>

              <!-- Purpose Badge -->
              <span class="purpose-badge">
                {{ getPurposeLabel(property.purpose) }}
              </span>

              <!-- Featured Badge -->
              <span class="featured-badge" *ngIf="property.isFeatured">
                <i class="bi bi-star-fill"></i>
                {{ 'property.card.featured' | translate }}
              </span>
            </div>

            <!-- Property Info -->
            <div class="property-info">
              <div class="property-header">
                <h3 class="property-title">{{ property.title }}</h3>
                <h3 class="property-title">{{ property.propertyType }}</h3>

                <p class="property-location">
                  <i class="bi bi-geo-alt-fill"></i>
                  {{ property.area }}, {{ property.city }}
                </p>
              </div>

              <div class="property-details">
                <span class="detail-item">
                  <i class="bi bi-door-open-fill"></i>
                  {{ property.rooms }} {{ 'property.card.beds' | translate }}
                </span>
                <span class="detail-item">
                  <i class="bi bi-droplet-fill"></i>
                  {{ property.bathrooms }} {{ 'property.card.baths' | translate }}
                </span>
                <span class="detail-item">
                  <i class="bi bi-arrows-fullscreen"></i>
                  {{ property.areaSpace }} mÂ²
                </span>
              </div>

              <div class="property-footer">
                <div class="property-price">
                  <span class="price-value">{{ property.price | currency:'USD':'symbol':'1.0-0' }}</span>
                  <span class="price-period" *ngIf="property.purpose === 'Rent'">{{ 'favorites.month' | translate }}</span>
                </div>
                <div class="property-contact-actions">
                  <a
                    class="contact-icon-btn whatsapp-btn"
                    [title]="'property.details.whatsapp' | translate"
                    [attr.aria-label]="'property.details.whatsapp' | translate"
                    [href]="getWhatsAppLink(phone)"
                    target="_blank"
                    rel="noopener noreferrer"
                    (click)="$event.stopPropagation()">
                    <i class="bi bi-whatsapp"></i>
                  </a>
                  <button
                    type="button"
                    class="contact-icon-btn phone-btn"
                    [title]="'property.details.call_now' | translate"
                    [attr.aria-label]="'property.details.call_now' | translate"
                    (click)="openCallModal(); $event.stopPropagation()">
                    <i class="bi bi-telephone-fill"></i>
                  </button>
                  <a
                    class="contact-icon-btn email-btn"
                    [href]="'mailto:' + email"
                    [title]="'property.details.send_email' | translate"
                    [attr.aria-label]="'property.details.send_email' | translate"
                    (click)="$event.stopPropagation()">
                    <i class="bi bi-envelope-fill"></i>
                  </a>
                  <button
                    type="button"
                    class="view-details-btn"
                    [routerLink]="['/property', property.id]"
                    (click)="$event.stopPropagation()">
                    <i class="bi bi-eye"></i>
                    {{ 'property.card.view' | translate }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- No Results -->
        <div class="no-results" *ngIf="properties.length === 0">
          <div class="no-results-icon">
            <i class="bi bi-search"></i>
          </div>
          <h3>{{ 'home.properties.no_results' | translate }}</h3>
          <p>{{ 'home.properties.try_adjusting' | translate }}</p>
        </div>

        <!-- See More Button -->
        <div class="see-more-section" *ngIf="hasMoreToLoad()">
          <button type="button" class="see-more-btn" (click)="loadMore()">
            {{ 'home.properties.see_more' | translate }}
            <i class="bi bi-arrow-down"></i>
          </button>
        </div>
      </div>

      <!-- Sidebar Filters -->
      <aside class="filters-sidebar">
        <div class="filters-header">
          <h3>{{ 'home.filters.title' | translate }}</h3>
          <button type="button" class="clear-filters" (click)="clearAllFilters()">
            {{ 'home.filters.clear_all' | translate }}
          </button>
        </div>

        <div class="filter-group">
          <h4 class="filter-title">
            <i class="bi bi-sort-down"></i>
            {{ 'home.filters.sort_by' | translate }}
          </h4>
          <div class="filter-options">
            <label class="filter-option">
              <input type="radio" name="sort" value="newest" (change)="onFilterChange($event)">
              <span>{{ 'home.filters.newest_first' | translate }}</span>
            </label>
            <label class="filter-option">
              <input type="radio" name="sort" value="price-low" (change)="onFilterChange($event)">
              <span>{{ 'home.filters.price_low_high' | translate }}</span>
            </label>
            <label class="filter-option">
              <input type="radio" name="sort" value="price-high" (change)="onFilterChange($event)">
              <span>{{ 'home.filters.price_high_low' | translate }}</span>
            </label>
            <label class="filter-option">
              <input type="radio" name="sort" value="popular" (change)="onFilterChange($event)">
              <span>{{ 'home.filters.most_popular' | translate }}</span>
            </label>
          </div>
        </div>

        <div class="filter-group">
          <h4 class="filter-title">
            <i class="bi bi-house"></i>
            {{ 'home.filters.property_type' | translate }}
          </h4>
          <div class="filter-options">
            <label class="filter-option">
              <input type="checkbox" value="Apartment" (change)="onPropertyTypeChange($event)">
              <span>{{ 'home.filters.apartment' | translate }}</span>
            </label>
            <label class="filter-option">
              <input type="checkbox" value="Villa" (change)="onPropertyTypeChange($event)">
              <span>{{ 'home.filters.villa' | translate }}</span>
            </label>
            <label class="filter-option">
              <input type="checkbox" value="Land" (change)="onPropertyTypeChange($event)">
              <span>{{ 'home.filters.land' | translate }}</span>
            </label>
          </div>
        </div>

        <div class="filter-group">
          <h4 class="filter-title">
            <i class="bi bi-currency-dollar"></i>
            {{ 'home.filters.price_range' | translate }}
          </h4>
          <div class="price-inputs">
            <input type="number" [placeholder]="'home.filters.min' | translate" class="price-input" #minPrice (change)="onPriceFilterChange()">
            <span class="price-separator">-</span>
            <input type="number" [placeholder]="'home.filters.max' | translate" class="price-input" #maxPrice (change)="onPriceFilterChange()">
          </div>
        </div>

        <div class="filter-group">
          <h4 class="filter-title">
            <i class="bi bi-arrows-fullscreen"></i>
            {{ 'home.filters.area' | translate }}
          </h4>
          <div class="filter-options">
            <label class="filter-option">
              <input type="checkbox" value="under100" (change)="onFilterChange($event)">
              <span>{{ 'home.filters.under_100' | translate }}</span>
            </label>
            <label class="filter-option">
              <input type="checkbox" value="100-200" (change)="onFilterChange($event)">
              <span>{{ 'home.filters.100_200' | translate }}</span>
            </label>
            <label class="filter-option">
              <input type="checkbox" value="200-300" (change)="onFilterChange($event)">
              <span>{{ 'home.filters.200_300' | translate }}</span>
            </label>
            <label class="filter-option">
              <input type="checkbox" value="300plus" (change)="onFilterChange($event)">
              <span>{{ 'home.filters.300_plus' | translate }}</span>
            </label>
          </div>
        </div>

        <div class="filter-group">
          <h4 class="filter-title">
            <i class="bi bi-door-open"></i>
            {{ 'home.filters.bedrooms' | translate }}
          </h4>
          <div class="filter-options">
            <label class="filter-option">
              <input type="checkbox" value="1" (change)="onFilterChange($event)">
              <span>{{ 'home.filters.1_bedroom' | translate }}</span>
            </label>
            <label class="filter-option">
              <input type="checkbox" value="2" (change)="onFilterChange($event)">
              <span>{{ 'home.filters.2_bedrooms' | translate }}</span>
            </label>
            <label class="filter-option">
              <input type="checkbox" value="3" (change)="onFilterChange($event)">
              <span>{{ 'home.filters.3_bedrooms' | translate }}</span>
            </label>
            <label class="filter-option">
              <input type="checkbox" value="4plus" (change)="onFilterChange($event)">
              <span>{{ 'home.filters.4_plus_bedrooms' | translate }}</span>
            </label>
          </div>
        </div>
      </aside>
    </div>
  </div>
</section>

<!-- Call Modal -->
<div class="call-modal" *ngIf="showCallModalFlag">
  <div class="call-modal-content">
    <h4>{{ 'property.call_us' | translate }}</h4>
    <p>{{ phone }}</p>
    <button (click)="makeCall()">{{ 'common.call_now' | translate }}</button>
    <button (click)="closeCallModal()">{{ 'common.close' | translate }}</button>
  </div>
</div>
